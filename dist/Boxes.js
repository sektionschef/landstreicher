class Boxes{constructor(i,s,t){logging.debug("Creating boxes."),this.width_points=i,this.height_points=s,this.pairing_count=t,this.columns_count=this.width_points.length-1,this.row_count=this.height_points.length-1,this.boxes_count=this.columns_count*this.row_count,logging.debug("Grid with "+this.columns_count+" columns, "+this.row_count+" rows, "+this.boxes_count+" boxes and "+this.pairing_count+" planned pairings."),this.virtual_boxes=[],this.possible_pairings_x=[],this.possible_pairings_y=[],this.real_boxes=[],this.boxes_completely_run=!1,this.create_virtual_boxes(),this.scout_possible_pairings(),this.real_boxes=this.virtual_boxes;for(var e=0;e<this.pairing_count;e++)this.pairing_count>0&&this.possible_pairings_x.length>0&&this.possible_pairings_y.length>0&&(this.choose_pairing(),this.pair(),this.remove_used_pairs());logging.debug("The real boxes are:"),logging.debug(this.real_boxes),this.create_lines()}create_virtual_boxes(){this.label_counter=0;for(let i=0;i<this.row_count;i++)for(let s=0;s<this.columns_count;s++)this.label_counter+=1,this.virtual_boxes.push({label:this.label_counter,a:{x:this.width_points[s],y:this.height_points[i]},b:{x:this.width_points[s+1],y:this.height_points[i]},c:{x:this.width_points[s+1],y:this.height_points[i+1]},d:{x:this.width_points[s],y:this.height_points[i+1]}});logging.debug("Virtual boxes:"),logging.debug(this.virtual_boxes)}scout_possible_pairings(){for(let i=0;i<this.virtual_boxes.length;i++)this.virtual_boxes[i].label%this.columns_count!=0&&this.possible_pairings_x.push({left:this.virtual_boxes[i].label,right:this.virtual_boxes[i+1].label}),this.virtual_boxes[i].label<=this.virtual_boxes.length-this.columns_count&&this.possible_pairings_y.push({left:this.virtual_boxes[i].label,right:this.virtual_boxes[i+this.columns_count].label});logging.debug(this.possible_pairings_x.length+" possible combinations for x:"),logging.debug(this.possible_pairings_x),logging.debug(this.possible_pairings_y.length+" possible combinations for y: "),logging.debug(this.possible_pairings_y)}choose_pairing(){fxrand()>=.5?(this.chosen_axis="x",this.chosen=getRandomFromList(this.possible_pairings_x),logging.debug("Pairing on the x axis with:"),logging.debug(this.chosen)):(this.chosen_axis="y",this.chosen=getRandomFromList(this.possible_pairings_y),logging.debug("Pairing on the y axis with:"),logging.debug(this.chosen))}pair(){let i,s;for(let t of this.virtual_boxes)t.label==this.chosen.left?(i={a:t.a,b:t.b,c:t.c,d:t.d},this.left_label=t.label):t.label==this.chosen.right&&(s={a:t.a,b:t.b,c:t.c,d:t.d},this.right_label=t.label);"x"==this.chosen_axis?this.paired_box={label:this.left_label+"+"+this.right_label,a:{x:i.a.x,y:i.a.y},b:{x:s.b.x,y:s.b.y},c:{x:s.c.x,y:s.c.y},d:{x:i.d.x,y:i.d.y}}:this.paired_box={label:this.left_label+"+"+this.right_label,a:{x:i.a.x,y:i.a.y},b:{x:i.b.x,y:i.b.y},c:{x:s.c.x,y:s.c.y},d:{x:s.d.x,y:s.d.y}},logging.debug("Adding the newly paired box: "),logging.debug(this.paired_box),this.real_boxes.push(this.paired_box),logging.debug("Remove original boxes from array.");for(var t=this.real_boxes.length-1;t>=0;t--)this.real_boxes[t].label==this.left_label&&this.real_boxes.splice(t,1),this.real_boxes[t].label==this.right_label&&this.real_boxes.splice(t,1)}remove_used_pairs(){logging.debug("Remove used pairs from both pools.");for(var i=this.possible_pairings_x.length-1;i>=0;i--)this.possible_pairings_x[i].left!=this.chosen.left&&this.possible_pairings_x[i].left!=this.chosen.right&&this.possible_pairings_x[i].right!=this.chosen.left&&this.possible_pairings_x[i].right!=this.chosen.right||this.possible_pairings_x.splice(i,1);for(i=this.possible_pairings_y.length-1;i>=0;i--)this.possible_pairings_y[i].left!=this.chosen.left&&this.possible_pairings_y[i].left!=this.chosen.right&&this.possible_pairings_y[i].right!=this.chosen.left&&this.possible_pairings_y[i].right!=this.chosen.right||this.possible_pairings_y.splice(i,1)}create_lines(){for(let i of this.real_boxes)i.lines=new Lines(i.a.x,i.a.y,i.b.x,i.c.y,PADDING_X,PADDING_Y,DISTANCE_BETWEEN_LINES)}show(){let i,s;push(),textFont(font),textSize(20*SCALING_FACTOR),rectMode(CORNERS);for(let t of this.real_boxes)noFill(),logging.getLevel()<=1?(strokeWeight(3),stroke(51)):noStroke(),logging.getLevel()<=1&&(rect(t.a.x*SCALING_FACTOR,t.a.y*SCALING_FACTOR,t.c.x*SCALING_FACTOR,t.c.y*SCALING_FACTOR),fill(0),i=(t.b.x-t.a.x)/2*SCALING_FACTOR,s=(t.d.y-t.a.y)/2*SCALING_FACTOR,text(t.label,(t.a.x+i)*SCALING_FACTOR,(t.a.y+s)*SCALING_FACTOR));pop()}show_lines(){for(let i of this.real_boxes)i.lines.show()}check_boxes_complete(){this.boxes_completely_run=!0;for(let i of this.real_boxes)i.lines.check_all_complete(),0==i.lines.all_lines_complete&&(this.boxes_completely_run=!1)}}